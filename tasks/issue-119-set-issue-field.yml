---
# yaml-language-server: $schema=https://raw.githubusercontent.com/dimfeld/llmutils/main/schema/tim-plan-schema.json
title: Implement and Test Issue Field Population
goal: To fix the bug preventing issue URLs from being added to multi-phase plans
  and to add robust testing for this feature.
id: 40
uuid: 426d2b5d-565d-46a9-93f9-2830ed0012e4
status: done
priority: high
planGeneratedAt: 2025-06-06T07:53:25.470Z
promptsGeneratedAt: 2025-06-06T07:58:27.245Z
createdAt: 2025-06-06T07:53:25.470Z
updatedAt: 2025-10-27T08:39:04.236Z
project:
  title: Set issue field in plan files when generating from a GitHub issue
  goal: The goal of this project is to ensure that when a plan is generated using
    the `tim generate --issue` command, the resulting YAML plan file(s)
    correctly include the URL of the source GitHub issue in their `issue` field.
  details: When a user generates a plan from a GitHub issue, it's important to
    maintain a link back to that issue for context and traceability. The
    `PlanSchema` already supports an `issue` field for this purpose. Currently,
    the logic to pass the issue URL from the `generate` command to the plan
    creation functions is partially implemented. It works correctly for
    single-phase plans but is broken for multi-phase plans. The `tim generate`
    command correctly fetches the issue URL and passes it in the
    `ExtractMarkdownToYamlOptions`. The `extractMarkdownToYaml` function in
    `src/tim/process_markdown.ts` correctly handles this for single-phase plans.
    However, the `saveMultiPhaseYaml` function in the same file has a bug where
    it ignores the passed-in issue URLs, leaving the `issue` field empty in
    multi-phase plan files. This project will fix the bug in the multi-phase
    generation logic and add comprehensive tests to ensure both single and
    multi-phase plan generation scenarios correctly populate the `issue` field.
tasks:
  - title: Correctly propagate issue URLs in multi-phase plan generation
    done: false
    description: The `saveMultiPhaseYaml` function in `src/tim/process_markdown.ts`
      currently ignores the issue URLs passed to it. This task involves
      modifying the function to correctly use the `options.issueUrls` and
      populate the `issue` field for each generated phase file.
  - title: Add tests for setting the issue field in generated plans
    done: false
    description: Create tests to verify that the `issue` field is correctly
      populated when generating a plan from a GitHub issue. This should cover
      both the single-phase and multi-phase plan generation scenarios. The tests
      will need to mock the GitHub API and LLM responses to provide predictable
      data and assert that the generated YAML files contain the expected issue
      URL.
rmfilter:
  - src/tim/commands/generate.ts
  - --with-imports
---

This phase will address the core bug in `saveMultiPhaseYaml` and then build out the necessary tests to verify the functionality for both single and multi-phase plans. This ensures that any plan generated from a GitHub issue, regardless of its structure, will contain the correct reference back to the issue.
